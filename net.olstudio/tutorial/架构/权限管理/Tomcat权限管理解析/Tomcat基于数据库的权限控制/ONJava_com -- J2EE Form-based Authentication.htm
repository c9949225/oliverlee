<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3c.org/TR/1999/REC-html401-19991224/loose.dtd">
<!-- saved from url=(0055)http://www.onjava.com/pub/a/onjava/2002/06/12/form.html -->
<HTML><HEAD><TITLE>ONJava.com -- J2EE Form-based Authentication</TITLE>
<META http-equiv=Content-Type content="text/html; charset=gb2312">
<META content=" ,O'Reilly Media,O'Reilly author, oreilly.com,oreilly,o'reilly" 
name=keywords>
<META 
content="J2EE Web containers support form-based authentication mechanisms. This article explains. how to integrate application-based security with that in other realms." 
name=description>
<META content="Jun. 12, 2002" name=date>
<META content=2002-06-12 name=search_date>
<META content="J2EE Form-based Authentication" name=pagename>
<META content=ONJava.com name=site>
<META content="Prabu Arumugam" name=author>
<META content=http://www.onjava.com/pub/a/onjava/2002/06/12/form.html 
name=safariu_url><!-- feed autodiscovery links --><LINK 
title="ONJava Articles and Weblogs" href="http://www.oreillynet.com/pub/feed/7" 
type=application/atom+xml rel=alternate><LINK 
title="ONJava Articles and Weblogs" 
href="http://www.oreillynet.com/pub/feed/7?format=rss1" type=application/rdf+xml 
rel=alternate><LINK title="ONJava Articles and Weblogs" 
href="http://www.oreillynet.com/pub/feed/7?format=rss2" type=application/rss+xml 
rel=alternate><!-- sc/388 Common JavaScript -->
<SCRIPT language=JavaScript 
src="ONJava_com -- J2EE Form-based Authentication.files/common.js" 
type=text/javascript></SCRIPT>
<LINK href="ONJava_com -- J2EE Form-based Authentication.files/main.css" 
type=text/css rel=STYLESHEET><!--WEBSIDESTORY CODE HBX1.0 (Universal)--><!--COPYRIGHT 1997-2004 WEBSIDESTORY,INC. ALL RIGHTS RESERVED. U.S.PATENT No. 6,393,479B1. MORE INFO:http://websidestory.com / privacy-->
<SCRIPT language=javascript type=text/javascript>
    var _hbEC=0,_hbE=new Array;function _hbEvent(a,b){b=_hbE[_hbEC++]=new Object();b._N=a;b._C=0;return b;}
    var hbx=_hbEvent("pv");hbx.vpc="HBX0100u";hbx.gn="ehg-oreilly.hitbox.com";

    //"BCB: onjava.com,/a/onjava/2002/06/12/form.html, DM52040251VS";

    hbx.acct="DM52040251VS;DM520404M4ZR"; //ACCOUNT NUMBER(S)
    hbx.pn="J2EE+Form-based+Authentication"; //PAGE NAME(S)
    hbx.mlc="/a/onjava/2002/06/12/;/onjava.com/a/onjava/2002/06/12/"; //MULTI-LEVEL CONTENT CATEGORY
    hbx.pndef="title"; //DEFAULT PAGE NAME
    hbx.ctdef="full"; //DEFAULT CONTENT CATEGORY

    hbx.lt="auto"; //LINK TRACKING 
    hbx.dlf="n"; //DOWNLOAD FILTER
    hbx.dft="n"; //DOWNLOAD FILE NAMING
    hbx.elf="n"; //EXIT LINK FILTER

    //SEGMENTS AND FUNNELS
    hbx.seg=""; //VISITOR SEGMENTATION
    hbx.fnl=""; //FUNNELS

    //CAMPAIGNS
    hbx.cmp=""; //CAMPAIGN ID
    hbx.cmpn="CMP"; //CAMPAIGN ID IN QUERY
    hbx.hra=""; //RESPONSE ATTRIBUTE
    hbx.hqsr=""; //RESPONSE ATTRIBUTE IN REFERRAL QUERY
    hbx.hqsp="ATT"; //RESPONSE ATTRIBUTE IN QUERY
    hbx.hlt=""; //LEAD TRACKING
    hbx.hla=""; //LEAD ATTRIBUTE
    hbx.gp=""; //CAMPAIGN GOAL
    hbx.gpn=""; //CAMPAIGN GOAL IN QUERY
    hbx.hcn=""; //CONVERSION ATTRIBUTE
    hbx.hcv=""; //CONVERSION VALUE
    hbx.cp="null"; //LEGACY CAMPAIGN
    hbx.cpd=""; //CAMPAIGN DOMAIN

    //CUSTOM VARIABLES
    hbx.ci="";//CUSTOMER ID
    hbx.hc1="";//CUSTOM 1
    hbx.hc2="";//CUSTOM 2
    hbx.hc3="";//CUSTOM 3
    hbx.hc4="";//CUSTOM 4 
    hbx.pec="";//ERROR CODES
    </SCRIPT>

<SCRIPT language=javascript1.1 
src="ONJava_com -- J2EE Form-based Authentication.files/hbx.js" defer 
type=text/javascript></SCRIPT>
<!--//--><!-- END WEBSIDESTORY CODE  --><!-- end hitbox -->
<SCRIPT src="ONJava_com -- J2EE Form-based Authentication.files/tabber.js" 
type=text/javascript></SCRIPT>
<!-- additional css --><LINK 
href="ONJava_com -- J2EE Form-based Authentication.files/articles.css" 
type=text/css rel=stylesheet>
<META content="MSHTML 6.00.2900.3314" name=GENERATOR></HEAD>
<BODY id=onjava>
<DIV id=page>
<DIV class=noindex id=header>
<H1><A href="http://www.onjava.com/"><IMG height=82 
alt="ONJava.com -- The Independent Source for Enterprise Java" hspace=0 
src="ONJava_com -- J2EE Form-based Authentication.files/onjava_logo.jpg" 
width=294 border=0></A></H1><!-- tabs -->
<DIV id=tabs>
<DIV class=noindex style="FLOAT: left; WIDTH: 450px; WHITE-SPACE: nowrap"><A 
href="http://www.oreillynet.com/"><IMG height=16 alt="O'Reilly Network." 
hspace=0 src="ONJava_com -- J2EE Form-based Authentication.files/orn_black.gif" 
width=113 border=0></A><A href="http://www.oreilly.com/"><IMG height=16 
alt=oreilly.com hspace=0 
src="ONJava_com -- J2EE Form-based Authentication.files/ora_gray.gif" width=82 
border=0></A><A href="http://safari.oreilly.com/"><IMG height=16 
alt="Safari Bookshelf." hspace=0 
src="ONJava_com -- J2EE Form-based Authentication.files/safari_gray.gif" 
width=114 border=0></A><A href="http://conferences.oreilly.com/"><IMG height=16 
alt=Conferences. hspace=0 
src="ONJava_com -- J2EE Form-based Authentication.files/conf_gray.gif" width=88 
border=0></A></DIV><!-- div class="noindex tiny" style="white-space: nowrap;float:right;width:175px;"><a href="/cs/user/login?x-redirect=/cs/user/home">Sign In/My Account</a> | <a href="http://epoch.oreilly.com/shop/cart.orm">View Cart</a>&nbsp;&nbsp;&nbsp;</div>
</div -->
<DIV class="noindex tiny" style="FLOAT: right; WIDTH: 175px"><A class=acct 
href="http://www.onjava.com/cs/user/login?x-redirect=/cs/user/home">Sign In/My 
Account</A> | <A class=cart href="http://epoch.oreilly.com/shop/cart.orm">View 
Cart</A>&nbsp;&nbsp;&nbsp;</DIV><!--
<a href="https://epoch.oreilly.com/account/default.orm" class="acct">My Account</a> 
 <a href="https://epoch.oreilly.com/shop/cart.orm" class="cart">View Cart</a>
--></DIV><!-- menubar -->
<DIV class=noindex>
<TABLE cellSpacing=1 cellPadding=0 width="100%" bgColor=#ffffff border=0>
  <TBODY>
  <TR bgColor=#ffffff>
    <TD 
    style="PADDING-RIGHT: 8px; PADDING-LEFT: 8px; PADDING-BOTTOM: 5px; PADDING-TOP: 5px" 
    align=middle bgColor=#000000><A class=nolinewhite 
      href="http://www.oreillynet.com/pub/q/articles">Articles</A></TD>
    <TD 
    style="PADDING-RIGHT: 8px; PADDING-LEFT: 8px; PADDING-BOTTOM: 5px; PADDING-TOP: 5px" 
    align=middle bgColor=#000000><A class=nolinewhite 
      href="http://weblogs.oreillynet.com/">Weblogs</A></TD>
    <TD 
    style="PADDING-RIGHT: 8px; PADDING-LEFT: 8px; PADDING-BOTTOM: 5px; PADDING-TOP: 5px" 
    align=middle bgColor=#000000><A class=nolinewhite 
      href="http://www.oreilly.com/catalog/">Books</A></TD>
    <TD 
    style="PADDING-RIGHT: 8px; PADDING-LEFT: 8px; PADDING-BOTTOM: 5px; PADDING-TOP: 5px" 
    align=middle bgColor=#000000><A class=nolinewhite 
      href="http://www.oreillylearning.com/">School</A></TD>
    <TD 
    style="PADDING-RIGHT: 8px; PADDING-LEFT: 8px; PADDING-BOTTOM: 5px; PADDING-TOP: 5px" 
    align=middle bgColor=#000000><A class=nolinewhite 
      href="http://www.oreilly.com/store/series/sc.csp">Short&nbsp;Cuts</A></TD>
    <TD 
    style="PADDING-RIGHT: 8px; PADDING-LEFT: 8px; PADDING-BOTTOM: 5px; PADDING-TOP: 5px" 
    align=middle bgColor=#000000><A class=nolinewhite 
      href="http://www.oreillynet.com/podcasts/">Podcasts</A></TD>
    <TD 
    style="PADDING-RIGHT: 8px; PADDING-LEFT: 8px; PADDING-BOTTOM: 5px; PADDING-TOP: 5px" 
    noWrap width="100%" 
    bgColor=#000000>&nbsp;<!-- right-most cell (empty)--></TD></TR></TBODY></TABLE></DIV>
<DIV id=leaderboard><IMG style="FLOAT: right" height=90 alt=advertisement 
src="ONJava_com -- J2EE Form-based Authentication.files/ad-tag-vertical.gif" 
width=11 border=0> 
<DIV style="MARGIN: 0px auto; WIDTH: 728px"><!-- Network Leaderboard Ad -->
<SCRIPT src="" type=text/javascript></SCRIPT>

<SCRIPT type=text/JavaScript>
<!--
      var CN_AD = new Object();
      CN_AD.AD_SZ = "728wX90h";
      CN_AD.PTYPE = "publisher";
      cnetGetAd(CN_AD);
//-->
</SCRIPT>
<!-- end ad --></DIV></DIV><!-- end leaderboard -->
<DIV id=textbar>
<DIV class=tinywhite style="VERTICAL-ALIGN: middle; PADDING-TOP: 3px"><!-- Network Text Link -->
<SCRIPT src="ONJava_com -- J2EE Form-based Authentication.files/ad.htm" 
type=text/javascript></SCRIPT>

<SCRIPT type=text/JavaScript>
<!--
      var CN_AD = new Object();
      CN_AD.AD_SZ = "75_text";
      CN_AD.PTYPE = "publisher";
      cnetGetAd(CN_AD);
//-->
</SCRIPT>
<!-- End ad --></DIV></DIV></DIV><!-- end header -->
<DIV id=page-content>
<DIV id=article><!-- feature bar ad : layout component 1894 --><!-- end feature bar ad --><BR><A 
onclick="addthis_url   = location.href; addthis_title = document.title; return addthis_click(this);" 
href="http://www.addthis.com/bookmark.php" target=_blank><IMG height=16 
alt="AddThis Social Bookmark Button" 
src="ONJava_com -- J2EE Form-based Authentication.files/button1-bm.gif" 
width=125 border=0></A>
<SCRIPT type=text/javascript>var addthis_pub = 'odewahn';</SCRIPT>

<SCRIPT src="ONJava_com -- J2EE Form-based Authentication.files/widget.php" 
type=text/javascript></SCRIPT>
 
<P><!-- begin content--><!-- begin  print-discuss-del.icio.us options -->
<DIV style="MARGIN: 0px 10px 0px 6px">
<DIV style="FLOAT: right; WIDTH: 170px"><A class=listen2 
title="Listen to this page." 
href="http://asp2.readspeaker.net/cgi-bin/oreillyrsone?lang=us&amp;voice=Paul&amp;customerid=171&amp;url=http://www.oreillynet.com/lpt/a/2411" 
target=_new>Listen</A> <A class=print 
title="Go to a print-friendly version of this page." 
href="http://www.onjava.com/lpt/a/2411">Print</A> <A class=subscribe 
title=Subscribe href="http://www.oreillynet.com/pub/feed/7">Subscribe to 
ONJava</A> <A class=newsletter 
href="http://www.oreillynet.com/cs/nl/home">Subscribe to Newsletters</A> <!--
<csif perl="(($RECORD{'id_subject'} eq '3') || #($RECORD{'id_subject'} eq '7') || ($RECORD{'id_subject'} eq #'14') || ($RECORD{'id_subject'} eq '8') || #($RECORD{'id_subject'} eq '22') || ($RECORD{'id_subject'} eq #'19') || ($RECORD{'id_subject'} eq '17') || #($RECORD{'id_subject'} eq '62'))"><a class="intellitxt" #href="http://www.oreillynet.com/pub/a/general/intellitxt.html">What #are those green links?</a>
</csif> --></DIV></DIV><!-- end  print-discuss-del.icio.us options --><!-- content here --><SPAN 
id=intelliTxt><!-- mega preparse mp: -->
<H2>J2EE Form-based Authentication</H2>by <A 
href="http://www.onjava.com/pub/au/922">Prabu Arumugam</A><BR>06/12/2002 
<P>Implementing security for Web applications is a mandatory task for architects 
and Web application developers. In J2EE, the Web containers have support for 
built-in security mechanisms for their applications.</P><!-- Digital Media MPU Ad --><!-- Network MPU Ad -->
<DIV style="PADDING-LEFT: 15px; FLOAT: right; WIDTH: 300px">
<SCRIPT src="ONJava_com -- J2EE Form-based Authentication.files/ad.htm" 
type=text/javascript></SCRIPT>

<SCRIPT type=text/JavaScript>
<!--
      var CN_AD = new Object();
      CN_AD.AD_SZ = "300wX250h";
      CN_AD.PTYPE = "publisher";
      cnetGetAd(CN_AD);
//-->
</SCRIPT>
</DIV><!-- End ad --><!-- me -->
<P>There are two major components of Web application security: authentication 
and authorization. J2EE-based Web containers offer three types of authentication 
mechanisms: basic, form-based, and mutual authentication. Most Web applications 
use the form-based authentication mechanism, since it allows applications to 
customize the authentication user interface. Web containers implement 
authorization on Web resources of applications, using security roles defined in 
the deployment descriptor of the Web application. </P>
<P>There are three issues that software architects and software developers come 
across using the form-based authentication mechanism: </P>
<UL>
  <LI>
  <P>How the form-based authentication works with other security realms, such as 
  database and LDAP (this is necessary because most organizations may already 
  have authentication information in database or LDAP form). </P><!-- sidebar begins --><!-- don't move sidebars --><!-- sidebar ends -->
  <LI>
  <P>How to add or delete authorization roles declared in the deployment 
  descriptor (<CODE>web.xml</CODE>) of the Web application. </P>
  <LI>
  <P>Web containers enforce authorization at Web resource level; however, an 
  application needs to enforce authorization at its functionality level within a 
  single Web resource. </P></LI></UL>
<P>Despite the fact that there is plenty of documentation and many examples 
available for form-based authentication, none of them clarifies these issues. 
Hence, most applications have implemented security in their own way. </P>
<P>This article demonstrates how the form-based authentication mechanism works 
with other security realms, especially the database. It also explains how Web 
containers use the security roles to implement authorization, and how 
applications can extend these security roles to protect functionalities within 
single resource. </P>
<H3>Form-Based Authentication</H3>
<P>Form-based authentication lets developers customize the authentication user 
interface. The login-config section of <CODE>web.xml</CODE> defines the type of 
authentication mechanism, and the URIs to login and error pages. </P><PRE><CODE>&lt;login-config&gt;
&lt;auth-method&gt;FORM&lt;/auth-method&gt;
&lt;form-login-config&gt;
&lt;form-login-page&gt;/login.jsp&lt;/form-login-page&gt;
&lt;form-error-page&gt;/fail_login.html&lt;/form-error-page&gt;
&lt;/form-login-config&gt;
&lt;/login-config&gt;</CODE></PRE>
<P>The login form must contain fields for entering username and password. These 
fields must be named <CODE>j_username</CODE> and <CODE>j_password</CODE>, 
respectively. This form should post these values to 
<CODE>j_security_check</CODE> logical name. </P>
<P>Here is an example showing how the form should be coded into an HTML page: 
</P><PRE><CODE>&lt;form method="POST" action="j_security_check"&gt;
&lt;input type="text" name="j_username"&gt;
&lt;input type="password" name="j_password"&gt;
&lt;/form&gt;</CODE></PRE>
<P>This form of authentication, which uses base64 encoding, can expose username 
and password unless all connections are over SSL. </P>
<P>The Web containers activate the authentication mechanism that has been 
configured for that resource, when protected Web resources are accessed. </P>
<P>Web containers perform the following steps to implement security of a Web 
application. </P>
<OL>
  <LI>
  <P>Determines whether the user has been authenticated when the protected Web 
  resources are accessed.</P>
  <LI>
  <P>If the user has not been authenticated yet, requests that the user provide 
  security credentials by redirecting to the login page defined in the 
  deployment descriptor.</P>
  <LI>
  <P>Validates the user's credentials against the security realm configured for 
  the container.</P>
  <LI>
  <P>Determines whether the authenticated user is authorized to access Web 
  resources defined in the deployment descriptor 
(<CODE>web.xml</CODE>).</P></LI></OL>
<P>In the deployment descriptor of a Web application, form-based authentication 
does not specify the security realm, as the basic authentication mechanism does. 
In other words, it does not explicitly declare the type of security realm it 
should use to authenticate a user. This causes some confusion as to what 
security realm it actually uses to authenticate the user. </P>
<P>Web containers perform the following steps to validate a user: </P>
<OL>
  <LI>
  <P>Determines the configured security realm for the container.</P>
  <LI>
  <P>Uses that security realm for authentication.</P></LI></OL>
<P>Since database and LDAP provide greater flexibility in maintaining 
information, most organizations may want this persistence for security 
authentication and authorization information. </P>
<P>Many Web containers have support for different types of security realms: 
database, LDAP, and custom realm. </P>
<P>For example, in the Tomcat Web container, <CODE>server.xml </CODE>configures 
database as its security realm. </P><PRE><CODE>&lt;Realm 
className="org.apache.catalina.realm.JDBCRealm" 
debug="99"
driverName="oracle.jdbc.driver.OracleDriver"
connectionURL="jdbc:oracle:thin:@{IPAddress}:{Port}:{Servicename}"
         connectionName="{DB Username}"
         connectionPassword="{Password}"
         userTable="users" 
userNameCol="username" 
         userCredCol="password"
userRoleTable="user_roles" 
roleNameCol="rolename" 
/&gt;</CODE></PRE>
<P>The <CODE>&lt;Realm&gt;</CODE> tag of Tomcat's <CODE>server.xml</CODE> 
defines the type of security realm that the container should use to authenticate 
a user. Note that the container uses this realm for Web applications whose 
authentication mechanism is form-based.</P>
<P><B>Note:</B> Please see the sections on deploying database security realm 
support for Tomcat and WebLogic below. </P><!-- article_sidebar2.view begins -->
<DIV align=center>
<DIV 
style="PADDING-RIGHT: 0px; BORDER-TOP: #8d8d8d 1px solid; PADDING-LEFT: 0px; PADDING-BOTTOM: 0.5em; MARGIN: 0.5em 0px; WIDTH: 70%; PADDING-TOP: 0.5em; BORDER-BOTTOM: #8d8d8d 1px solid">
<TABLE cellSpacing=0 cellPadding=0 width="70%" align=center border=0>
  <TBODY>
  <TR>
    <TD vAlign=top align=middle width="50%"><A 
      href="http://www.oreilly.com/catalog/9780596001520/index.html?CMP=ILL-4GV796923290"><IMG 
      alt="Java Enterprise in a Nutshell" hspace=20 
      src="ONJava_com -- J2EE Form-based Authentication.files/0596001525_cat.gif" 
      border=0></A> </TD>
    <TD vAlign=top width="50%">
      <P class=headline>Related Reading</P>
      <P class=medlist><SPAN class=title><A 
      href="http://www.oreilly.com/catalog/9780596001520/index.html?CMP=ILL-4GV796923290">Java 
      Enterprise in a Nutshell</A></SPAN><STRONG><BR>By <A 
      href="http://www.oreillynet.com/pub/au/454">William Crawford</A>, <A 
      href="http://www.oreillynet.com/pub/au/582">Jim Farley</A>, <A 
      href="http://www.oreillynet.com/pub/au/156">David Flanagan</A></STRONG> 
</P>
      <DIV class=secondary><!-- builds links to list in sidebar --><A 
      href="http://www.oreilly.com/catalog/9780596001520/toc.html?CMP=ILL-4GV796923290">Table 
      of Contents</A><BR><A 
      href="http://www.oreilly.com/catalog/9780596001520/inx.html?CMP=ILL-4GV796923290">Index</A><BR><A 
      href="http://www.oreilly.com/catalog/9780596001520/chapter/index.html?CMP=ILL-4GV796923290">Sample 
      Chapter</A><BR><BR><B><A 
      href="http://safari.oreilly.com/0596001525?cid=orm-cat-readnow-0596001525">Read 
      Online--Safari</A></B><BR><SPAN class=tiny>Search this book on 
      Safari:</SPAN> 
      <FORM action=http://safari.oreilly.com/JVXSL.asp method=post><INPUT 
      type=hidden value=1 name=s><INPUT type=hidden value=1 name=b> <INPUT 
      type=hidden value=1 name=t><INPUT type=hidden value=1 name=f> <INPUT 
      type=hidden value=1 name=c><INPUT type=hidden value=1 name=l> <INPUT 
      type=hidden value=section name=view> <INPUT tabIndex=1 size=15 
      name=se_text>&nbsp;<INPUT title="Execute the search" type=image height=17 
      alt=Go width=23 
      src="ONJava_com -- J2EE Form-based Authentication.files/safari_btn_go.gif" 
      align=absMiddle border=0 name=go><BR><SELECT name=se_isbn> <OPTION 
        value=0-596-00152-5 selected>Only This Book</OPTION> <OPTION 
        value="">All of Safari</OPTION></SELECT><BR><INPUT type=checkbox value=1 
      name=code><SPAN class=tiny>Code Fragments only</SPAN> 
  </FORM></DIV></TD></TR></TBODY></TABLE></DIV></DIV><!-- article_sidebar2.view ends -->
<H4>Authorization</H4>
<P>Once the user has been authenticated, the container retrieves security roles 
for the authenticated user and checks to see if the user belongs to one of the 
roles defined in the <CODE>&lt;auth-constraint&gt;</CODE> tag of the deployment 
descriptor. The Web container displays an error message if the user does not 
belong to one of roles. </P>
<P>The <CODE>&lt;security-constraint&gt;</CODE> tag of the deployment descriptor 
(<CODE>web.xml</CODE>) defines protected Web resources and a list of roles that 
have access to these Web resources. </P><PRE><CODE>&lt;security-constraint&gt;
&lt;web-resource-collection&gt;
&lt;web-resource-name&gt;AdminPages&lt;/web-resource-name&gt;
&lt;description&gt; accessible by authorised users &lt;/description&gt;
&lt;url-pattern&gt;/admin/*&lt;/url-pattern&gt;
&lt;http-method&gt;GET&lt;/http-method&gt;
&lt;/web-resource-collection&gt;
&lt;auth-constraint&gt;
&lt;description&gt;These are the roles who have access&lt;/description&gt;
&lt;role-name&gt;manager&lt;/role-name&gt;
&lt;/auth-constraint&gt;
&lt;/security-constraint&gt;</CODE></PRE>
<P>Web containers enforce authorization at a page level. However, commercial 
applications may also want to enforce authorization on functionalities within a 
single page. This may require that some additional new application-specific 
security roles be defined in the application. To control access to 
functionalities, the application needs to understand the notion of privileges 
for a role. The Web container specification does not address privileges. </P>
<P>Since authorization roles are dynamic, developers often get confused as to 
whether these security roles need to be added to the deployment descriptor. Web 
containers just need one role defined in the deployment descriptor for the 
application to take advantage of security support. So, the application can 
define one high-level role and assign all users to this role. This allows all 
users in this role to have access to the Web resources. </P>
<P>In addition, the application can define additional roles to enforce 
authorization on low-level functionalities within a single Web resource. These 
low-level security roles do not need to be in the deployment descriptor, since 
the application has been configured with a high-level security role that 
contains all of the users in the application. This allows Web applications to 
take advantage of container authorization support, and to implement 
application-specific authorization. </P>
<P>For example, you can define an administrator role for all of the users at a 
high level in the deployment descriptor to protect administration Web resources. 
This allows all of the users in the administrator role to access the 
administration pages. To control other functionalities within the administration 
pages, you can create new roles, such as <CODE>sysadmin</CODE> or 
<CODE>appadmin</CODE>, within the application. </P>
<P>The application can extend these security roles to have privileges. Then, the 
application can use these privileges to control access to its functionalities. 
</P>
<P>Despite the fact that application-specific security roles are not defined in 
the deployment descriptors, these roles can still be used in the 
<CODE>isUserInRole</CODE> method to determine whether the user in these security 
roles. </P>
<H4>Advantages</H4>
<UL>
  <LI>
  <P>Web applications do not need to implement the authentication mechanism by 
  themselves. It is simply a matter of configuring the Web application.</P>
  <LI>
  <P>Web applications can implement programmatic security using 
  <CODE>getRemoteUser</CODE>, <CODE>IsUserInRole</CODE>, and 
  <CODE>getUserPrincipal</CODE> methods.</P>
  <LI>
  <P>The Web container is capable of propagating authentication information to 
  EJB containers.</P></LI></UL>
<H3>Configuring the Database Security Realm in Tomcat</H3>
<OL>
  <LI>
  <P>Create User Table</P>
  <P>This table needs the username and password columns.</P>
  <P><CODE>create table users (username varchar(20) not null, password(20) not 
  null)</CODE></P>
  <LI>
  <P>Create Role Table</P>
  <P>This table maintains the list of roles in application. It just needs role 
  name column in the table.</P>
  <P><CODE>create table roles (rolename varchar(20) not null)</CODE></P>
  <LI>
  <P>Create User-Role Association Table</P>
  <P>This table maintains association between a user and roles. A user can 
  belong to one or more roles.</P>
  <P><CODE>create table user_roles (username varchar(20) not null, rolename 
  varchar(20) not null) </CODE></P>
  <LI>
  <P>Insert data into tables</P>
  <P><CODE>insert into users values('user1', 'password')</CODE></P>
  <P><CODE>insert into role values('manager')<BR>insert into user_roles 
  values('user1', 'manager')</CODE></P>
  <LI>
  <P>Create User Table</P>
  <P>This table needs the username and password columns.</P>
  <P><CODE>create table users (username varchar(20) not null, password(20) not 
  null)</CODE></P>
  <LI>
  <P>Create Role Table</P>
  <P>This table maintains the list of roles in the application. It just needs 
  the role name column in the table.</P>
  <P><CODE>create table roles (rolename varchar(20) not null)</CODE></P>
  <LI>
  <P>Create User-Role Association Table</P>
  <P>This table maintains association between a user and roles. A user can 
  belong to one or more roles.</P>
  <P><CODE>create table user_roles (username varchar(20) not null, rolename 
  varchar(20) not null)</CODE></P>
  <LI>
  <P>Insert data into tables</P>
  <P><CODE>insert into users values('user1', 'password')</CODE></P>
  <P><CODE>insert into role values('manager')</CODE></P>
  <P><CODE>insert into user_roles values('user1', 'manager') </CODE></P>
  <LI>
  <P>Configure Tomcat (This example uses the Oracle thin driver) by copying this 
  information in <CODE>server.xml</CODE> in the <CODE>{tomcat}\conf\</CODE> 
  folder. (Tomcat uses memory realm as default realm. Comment the memory 
  realm.)</P><PRE><CODE>&lt;Realm 
className="org.apache.catalina.realm.JDBCRealm" 
         debug="99"
driverName="oracle.jdbc.driver.OracleDriver" 
connectionURL="jdbc:oracle:thin:@{IP address}:{Port}:{Servicename}"
connectionName="{DB Username}"
         connectionPassword="{Password}"
         userTable="users" 
         userNameCol="username" 
         userCredCol="password"
         userRoleTable="user_roles" 
         roleNameCol="rolename" 
/&gt;</CODE></PRE>
  <P>Replace the following values with environment values </P>
  <P><CODE>{IP Address}</CODE> - IP address of database server</P>
  <P><CODE>{Port}</CODE> - Port number</P>
  <P><CODE>{Servicename}</CODE> - Service name</P>
  <P><CODE>{DB Username}</CODE> - database login</P>
  <P><CODE>{Password}</CODE> - password to database login</P>
  <P><B>Note</B>: You need to have the JDBC driver for your database. (The 
  Oracle thin driver is used in this example.)</P>
  <LI>
  <P>Copy the Oracle thin driver JAR file or JDBC driver for your database 
  (<CODE>oracle_thin_driver.jar</CODE>) into the 
  <CODE>{tomcat_home}/server/lib</CODE> directory.</P>
  <LI>
  <P>Configure the Web application deployment descriptor with security 
  constraints.</P><PRE><CODE>&lt;security-constraint&gt;
&lt;web-resource-collection&gt;
&lt;web-resource-name&gt;Protected Area&lt;/web-resource-name&gt;
&lt;!-- Define the context-relative URL(s) to be protected --&gt;
&lt;url-pattern&gt;/*&lt;/url-pattern&gt;
&lt;http-method&gt;DELETE&lt;/http-method&gt;
&lt;http-method&gt;GET&lt;/http-method&gt;
&lt;http-method&gt;POST&lt;/http-method&gt;
&lt;http-method&gt;PUT&lt;/http-method&gt;
&lt;/web-resource-collection&gt;
&lt;auth-constraint&gt;
&lt;role-name&gt;manager&lt;/role-name&gt;
&lt;/auth-constraint&gt;
&lt;user-data-constraint&gt;&lt;transport-guarantee&gt;
NONE&lt;/transport-guarantee&gt;&lt;/user-data-constraint&gt;

&lt;/security-constraint&gt;

&lt;!-- Default login configuration uses form-based authentication --&gt;

&lt;login-config&gt;
&lt;auth-method&gt;FORM&lt;/auth-method&gt;
&lt;realm-name&gt;Example Form-Based Authentication Area&lt;/realm-name&gt;
&lt;form-login-config&gt;
&lt;form-login-page&gt;/jsp/login.jsp&lt;/form-login-page&gt;
&lt;form-error-page&gt;/jsp/error.jsp&lt;/form-error-page&gt;
&lt;/form-login-config&gt;
&lt;/login-config&gt;</CODE></PRE>
  <P>Note that the <CODE>&lt;role-name&gt;</CODE> value of this tag in 
  <CODE>&lt;auth-constraint&gt;</CODE> should be one of the role names in the 
  <CODE>user-roles</CODE> table.</P></LI></OL>
<H3>Deploying The Sample Program Into Tomcat</H3>
<OL>
  <LI>
  <P>Configure Tomcat using the instructions defined in the previous 
section.</P>
  <LI>
  <P>Download the <A 
  href="http://www.onjava.com/onjava/2002/06/12/examples/security-form-based.war"><CODE>security-form-based.war</CODE></A> 
  file and copy it into Tomcat's <CODE>webapps</CODE> directory. </P>
  <LI>
  <P>Start the Tomcat server.</P>
  <LI>
  <P>Open a Web browser and go to <CODE>http://{ip address:port 
  no}/security-form-based/protected/index.jsp</CODE>.</P>
  <LI>
  <P>Type in the username and the password (user1, password).</P></LI></OL>
<H3>Configuring the Database Security Realm in WebLogic</H3>
<P>There is <A 
href="http://e-docs.bea.com/wls/docs61/adminguide/cnfgsec.html%20-%201052867">very 
good documentation</A> on configuring the database security realm. Please refer 
to this link. </P>
<P>Configure your Web application deployment descriptor, similar to the one 
shown in the configuration steps for Tomcat. </P>
<P>One difference between Tomcat and WebLogic deployment descriptors is that the 
deployment descriptor for WebLogic requires the following section, while Tomcat 
does not require this section. </P><PRE><CODE>&lt;security-role&gt;
&lt;description&gt;
Manager security role
&lt;/description&gt;
&lt;role-name&gt;
manager
&lt;/role-name&gt;
&lt;/security-role&gt;</CODE></PRE>
<H3>Conclusion</H3>
<P>This article has provided in-depth understanding of the form-based mechanism 
and how it works with database security realms to handle authentication. Web 
applications can take advantage of the form-based mechanism to protect their 
resources while at the same time using legacy security realms for authentication 
information. </P>
<P>In addition, this article has described the level of authorization support 
provided by J2EE Web containers and how you can define new security roles 
without modifying the deployment descriptor of a Web application. </P>
<H3>Resources</H3>
<P>Download the source code: <A 
href="http://www.onjava.com/onjava/2002/06/12/examples/security.zip">security.zip</A>. 
</P>
<P>Download the .war file: <A 
href="http://www.onjava.com/onjava/2002/06/12/examples/security-form-based.war">security-form-based.war</A>. 
</P>
<P><A href="http://java.sun.com/j2ee/tutorial/1_3-fcs/doc/Security4.html">Web 
Tier Security Documentation</A> from Sun. </P>
<P><A 
href="http://jakarta.apache.org/tomcat/tomcat-3.3-doc/JDBCRealm-howto.html">Tomcat 
JDBC Realm</A>. </P>
<P><A 
href="http://e-docs.bea.com/wls/docs61/adminguide/cnfgsec.html%20-%201052867">WebLogic 
RDBMS Realm</A> </P>
<P><I><A href="http://www.onjava.com/pub/au/922">Prabu Arumugam</A> is a 
software architect and senior Java developer at Forest Express, LLC. </I></P>
<HR noShade SIZE=1>

<P>Return to <A href="http://www.onjava.com/">ONJava.com</A>.</P></SPAN><!-- end content --><IMG 
height=1 alt=" " 
src="ONJava_com -- J2EE Form-based Authentication.files/trans.gif" 
width=400><BR><BR><BR><!-- end content -->
<SCRIPT type=text/javascript><!--
google_ad_client = "pub-3431100313772407";
google_ad_width = 728;
google_ad_height = 90;
google_ad_format = "728x90_as";
google_ad_type = "text";
//2007-03-30: oreilly-net_oreillynet_banner
google_ad_channel = "2247570837";
google_color_border = "006666";
google_color_bg = "EFEFEF";
google_color_link = "000000";
google_color_text = "000000";
google_color_url = "0000FF";
google_hints = 'application development, application development tools, software, developer';
//-->
</SCRIPT>

<SCRIPT src="ONJava_com -- J2EE Form-based Authentication.files/show_ads.js" 
type=text/javascript>
</SCRIPT>
</DIV><!-- #article -->
<DIV id=related><!--Add Beautiful Code Feeds -->
<DIV class=sidebar-item>
<DIV class=sidebar-item-content><A 
href="http://beautifulcode.oreillynet.com/"><IMG 
src="ONJava_com -- J2EE Form-based Authentication.files/beautiful_code_weblogs.gif" 
border=0></A> 
<P class=secondary><B><A 
href="http://beautifulcode.oreillynet.com/2008/04/resource_management_a_critical.php">Resource 
Management: A Critical Look at RAII</A></B> <EM>Michael Feathers</EM></P>
<P class=secondary><B><A 
href="http://beautifulcode.oreillynet.com/2008/04/the_logs_that_bind_1.php">The 
Logs That Bind..</A></B> <EM>Michael Feathers</EM></P>
<P class=secondary><B><A 
href="http://beautifulcode.oreillynet.com/2008/04/the_design_boundary.php">Outside 
the Design Boundary</A></B> <EM>Michael Feathers</EM></P>
<P class=secondary><B><A 
href="http://beautifulcode.oreillynet.com/2008/04/can_a_program_lie_to_you_the_w.php">Can 
a program lie to you the way a story or essay can?</A></B> <EM>Andy 
Oram</EM></P>
<P class=smalltext align=right><A 
href="http://beautifulcode.oreillynet.com/">&gt; More from Beautiful 
Code</A></P></DIV></DIV><!-- search -->
<DIV class=sidebar-item>
<H3>Search ONJava</H3>
<DIV class=sidebar-item-content><NOINDEX>
<FORM id=search name=searchForm onsubmit=processQuery(); 
action=http://promosearch.atomz.com/search/promosearch method=get><INPUT id=src 
accessKey=s maxLength=80 size=10 name=query> <INPUT type=hidden value=test 
name=sp-q> <INPUT type=hidden value=sp1000a5a9 name=sp-a> <INPUT type=hidden 
value=ISO-8859-1 name=sp-f> <INPUT type=hidden value=general name=sp-t> <INPUT 
type=hidden value=cat name=sp-x-1> <INPUT type=hidden value=ONJava name=sp-q-1> 
<INPUT type=hidden value=cat2 name=sp-x-2> <INPUT type=hidden name=sp-q-2> 
<INPUT type=hidden value=25 name=sp-c> <INPUT type=hidden value=all name=sp-p> 
<INPUT type=hidden value=Articles|Books|Conferences|Other|Weblogs name=sp-k> 
<INPUT type=hidden value=ONJava name=c> <INPUT type=hidden name=p> <INPUT onclick="return searchverif();" type=submit value=Go name=search> 
</FORM></NOINDEX></DIV></DIV>
<DIV class=sidebar-item>
<H3>Tagged Articles</H3>
<DIV class="sidebar-item-content tags">
<P class=addtags><A class=delicious title="Post to del.icio.us." 
onclick="window.open('http://del.icio.us/post?v=4&amp;partner=orn&amp;noui&amp;jump=close&amp;url='+encodeURIComponent(location.href)+'&amp;title='+encodeURIComponent(document.title),'delicious','toolbar=no,width=700,height=400'); return false;" 
href="http://del.icio.us/post">Post to del.icio.us</A><BR><BR>This article has 
been tagged:</P>
<DIV class=tabber>
<DIV class=tabbertab>
<H2>java</H2>
<P style="PADDING-TOP: 5px">Articles that share the tag <EM>java</EM>:</P>
<P><A 
href="http://www.onjava.com/pub/a/onjava/2006/08/16/profiling-with-eclipse-callisto.html">Profiling 
Your Applications with Eclipse Callisto</A> <SPAN class=tagcount>(113 
tags)</SPAN></P>
<P><A 
href="http://www.onjava.com/pub/a/onjava/2005/09/14/what-is-a-portlet.html">What 
Is a Portlet</A> <SPAN class=tagcount>(101 tags)</SPAN></P>
<P><A href="http://www.onjava.com/pub/a/onjava/2005/01/12/xpath.html">Parsing an 
XML Document with XPath</A> <SPAN class=tagcount>(79 tags)</SPAN></P>
<P><A href="http://www.onjava.com/pub/a/onjava/2005/04/27/restweb.html">The REST 
of the Web</A> <SPAN class=tagcount>(75 tags)</SPAN></P>
<P><A href="http://www.onjava.com/pub/a/onjava/2005/02/09/eclipse.html">Eclipse 
Plugins Exposed, Part 1: A First Glimpse</A> <SPAN class=tagcount>(69 
tags)</SPAN></P>
<P class=more><A href="http://www.oreillynet.com/tags.csp?tag=java">View 
All</A></P></DIV>
<DIV class=tabbertab>
<H2>j2ee</H2>
<P style="PADDING-TOP: 5px">Articles that share the tag <EM>j2ee</EM>:</P>
<P><A href="http://www.onjava.com/pub/a/onjava/2005/09/07/maven.html">Building 
J2EE Projects with Maven</A> <SPAN class=tagcount>(48 tags)</SPAN></P>
<P><A href="http://www.onjava.com/pub/a/onjava/2004/06/09/jsf.html">Improving 
JSF by Dumping JSP</A> <SPAN class=tagcount>(27 tags)</SPAN></P>
<P><A 
href="http://www.onjava.com/pub/a/onjava/2003/04/02/log4j_ejb.html">Understanding 
Classloaders: log4j in a J2EE Environment</A> <SPAN class=tagcount>(25 
tags)</SPAN></P>
<P><A 
href="http://www.onjava.com/pub/a/onjava/2006/07/19/what-is-geronimo.html">What 
Is Geronimo?</A> <SPAN class=tagcount>(23 tags)</SPAN></P>
<P><A href="http://www.onjava.com/pub/a/onjava/2005/06/29/spring-ejb3.html">POJO 
Application Frameworks: Spring Vs. EJB 3.0</A> <SPAN class=tagcount>(20 
tags)</SPAN></P>
<P class=more><A href="http://www.oreillynet.com/tags.csp?tag=j2ee">View 
All</A></P></DIV>
<DIV class=tabbertab>
<H2>security</H2>
<P style="PADDING-TOP: 5px">Articles that share the tag <EM>security</EM>:</P>
<P><A href="http://www.xml.com/pub/a/2005/07/13/secure-rss.html">Secure RSS 
Syndication</A> <SPAN class=tagcount>(169 tags)</SPAN></P>
<P><A 
href="http://www.onlamp.com/pub/a/security/2004/10/07/googling_for_vulnerabilities.html">Google 
Your Site For Security Vulnerabilities</A> <SPAN class=tagcount>(74 
tags)</SPAN></P>
<P><A 
href="http://www.onlamp.com/pub/a/bsd/2006/08/03/FreeBSDBasics.html">Building a 
Desktop Firewall</A> <SPAN class=tagcount>(64 tags)</SPAN></P>
<P><A 
href="http://www.oreillynet.com/pub/a/network/2005/09/12/alan-cox.html">The Next 
50 Years of Computer Security: An Interview with Alan Cox</A> <SPAN 
class=tagcount>(42 tags)</SPAN></P>
<P><A 
href="http://www.windowsdevcenter.com/pub/a/windows/2005/04/19/WiFiHacks.html">Protect 
Yourself from WiFi Snoops</A> <SPAN class=tagcount>(40 tags)</SPAN></P>
<P class=more><A href="http://www.oreillynet.com/tags.csp?tag=security">View 
All</A></P></DIV></DIV></DIV></DIV><!-- sponsored developer resources -->
<DIV class=sidebar-item>
<H3>Sponsored Resources</H3>
<DIV class=sidebar-item-content>
<UL 
style="PADDING-RIGHT: 0px; PADDING-LEFT: 0px; PADDING-BOTTOM: 0px; MARGIN: 0px 0px 0px 1.2em; PADDING-TOP: 0px">
  <LI><A href="http://digitalmedia.oreilly.com/lightroom/">Inside Lightroom</A> 
  </LI></UL></DIV></DIV><!-- csperl file="article_related_to" topic="25" / --><!-- ###### AK start ###### -->
<DIV><A id=akAPI></A>
<SCRIPT type=text/javascript>

    var akApiKey = 'RecEngine-49CCF850-02C7-B730-5489-DB7D929405CD';

    var akTarget = 'http://www.onjava.com/pub/a/onjava/2002/06/12/form.html';

    var akDescription = 'J2EE Form-based Authentication';

    var akThumbnailUrl = 'http://oreillynet.com/standard-tiles/java/111-tiger.jpg';

    var akTargetType = 'article';
    var akRegion = 'OnJavaArticle';
    var akIntent = 'VIEW';
 

    var akScript = document.createElement('script');

    akScript.setAttribute('src','http://api.aggregateknowledge.com/2007/01/15/js/'  + (new Date()).valueOf() % 3600000 + '.js');

   document.getElementsByTagName('head')[0].appendChild(akScript);

</SCRIPT>
</DIV><!-- ####### AK end ###### -->
<DIV 
style="PADDING-BOTTOM: 10px; PADDING-TOP: 10px; BACKGROUND-COLOR: #eee; TEXT-ALIGN: center"><IMG 
style="PADDING-BOTTOM: 10px" alt=Advertisement 
src="ONJava_com -- J2EE Form-based Authentication.files/advertisement.gif"><BR>
<DIV align=center><!-- Network Skyscraper Ad -->
<SCRIPT src="ONJava_com -- J2EE Form-based Authentication.files/ad.htm" 
type=text/javascript></SCRIPT>

<SCRIPT type=text/JavaScript>
<!--
      var CN_AD = new Object();
      CN_AD.AD_SZ = "160wX600h";
      CN_AD.PTYPE = "publisher";
      cnetGetAd(CN_AD);
//-->
</SCRIPT>
<!-- End ad --></DIV></DIV></DIV><!-- #related --></DIV><!-- #page-content --><!-- footer -->
<DIV class=noindex id=footer>
<P class=secondary align=center><A 
href="http://www.onjava.com/pub/a/mediakit/contact.html">Contact Us</A> | <A 
href="http://www.onjava.com/mediakit/">Advertise with Us</A> | <A 
href="http://www.onjava.com/pub/a/mediakit/privacy.html">Privacy Policy</A> | <A 
href="http://press.oreilly.com/">Press Center</A> | <A 
href="http://jobs.oreilly.com/">Jobs</A> </P>
<P class=tiny align=center>Copyright &copy; 2000-2008 O'Reilly Media, Inc. All Rights 
Reserved. | (707) 827-7000 / (800) 998-9938 <BR>All trademarks and registered 
trademarks appearing on the O'Reilly Network are the property of their 
respective owners.</P>
<P class=tiny align=center>For problems or assistance with this site, email
<SCRIPT type=text/javascript>
<!--
var name = "help";
var domain = "oreillynet.com";
var display = "";
var subject = "";
var ending = "";
var style = "";
document.write('<a class="' + style + '" href="mailto:' + name + '&#64;' + domain + '?subject=' + subject + '">');
if (display) {
 document.write(display);
} else {
 document.write(name + '&#64;' + domain);
}
document.write('</a>' + ending);

// -->
</SCRIPT>
 </P><BR><!-- Quantcast sc/1987 --><!-- Start Quantcast tag -->
<SCRIPT src="ONJava_com -- J2EE Form-based Authentication.files/quant.js" 
type=text/javascript></SCRIPT>

<SCRIPT type=text/javascript>
_qacct="p-20l78bOOCbhcg";quantserve();</SCRIPT>
<NOSCRIPT><IMG style="DISPLAY: none" height=1 alt=Quantcast src="" 
width=1></NOSCRIPT> <!-- End Quantcast tag --></DIV><!-- #footer --></DIV><!-- #page --></BODY></HTML>
